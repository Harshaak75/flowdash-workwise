"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.buildTeamReportHTML = buildTeamReportHTML;
function buildTeamReportHTML(report, team, snapshots, trendData) {
    const trends = trendData || [];
    return `
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    @page {
      size: A4;
      margin: 24mm;
    }

    body {
      font-family: Helvetica, Arial, sans-serif;
      color: #333;
      margin: 0;
    }

    h1 {
      color: #2563eb;
      text-align: center;
      margin-bottom: 6px;
    }

    .subtitle {
      text-align: center;
      color: #666;
      font-size: 13px;
      margin-bottom: 30px;
    }

    /* KPI SUMMARY */
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-bottom: 40px;
    }

    .summary-card {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 16px;
      text-align: center;
    }

    .summary-card span {
      font-size: 11px;
      color: #6b7280;
      text-transform: uppercase;
      font-weight: bold;
    }

    .summary-card div {
      font-size: 22px;
      font-weight: bold;
      margin-top: 6px;
    }

    /* SECTIONS */
    .section {
      margin-top: 40px;
      page-break-inside: avoid;
    }

    .section h3 {
      text-align: center;
      font-size: 15px;
      color: #374151;
      margin-bottom: 16px;
    }

    /* CHART GRID */
    .charts-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-bottom: 40px;
    }

    .chart-box {
      text-align: center;
    }

    .chart-container {
      width: 100%;
      height: 260px;
      position: relative;
    }

    .trend-container {
      height: 240px;
    }

    canvas {
      width: 100% !important;
      height: 260px !important;
    }

    /* TABLE */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      font-size: 13px;
    }

    th, td {
      border: 1px solid #e5e7eb;
      padding: 10px;
      text-align: left;
    }

    th {
      background: #f3f4f6;
      color: #374151;
    }

    tr:nth-child(even) {
      background: #f9fafb;
    }

    footer {
      margin-top: 40px;
      text-align: center;
      font-size: 11px;
      color: #9ca3af;
    }
  </style>
</head>

<body>

  <h1>Team Performance Report</h1>
  <div class="subtitle">
    Period: ${report.fromDate.toDateString()} — ${report.toDate.toDateString()}
  </div>

  <div class="summary-grid">
    <div class="summary-card">
      <span>Total Tasks</span>
      <div>${team.totalTasks}</div>
    </div>
    <div class="summary-card">
      <span>Completed</span>
      <div>${team.completedTasks}</div>
    </div>
    <div class="summary-card">
      <span>Total Hours</span>
      <div>${team.totalHours}</div>
    </div>
    <div class="summary-card">
      <span>Avg Productivity</span>
      <div>${team.avgProductivity}</div>
    </div>
  </div>

  <!-- CHARTS -->
  <div class="section">
    <div class="charts-grid">
      <div class="chart-box">
        <h3>Task Distribution</h3>
        <div class="chart-container">
          <canvas id="teamTasks"></canvas>
        </div>
      </div>

      <div class="chart-box">
        <h3>Productivity Leaderboard</h3>
        <div class="chart-container">
          <canvas id="teamProductivity"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- TREND -->
  <div class="section">
    <h3>Team Output Trend (Daily Completions)</h3>
    <div class="chart-container trend-container">
      <canvas id="teamTrend"></canvas>
    </div>
  </div>

  <!-- TABLE -->
  <div class="section">
    <h3 style="text-align:left">Employee Breakdown</h3>
    <table>
      <tr>
        <th>Employee</th>
        <th>Total Tasks</th>
        <th>Completed</th>
        <th>Hours</th>
        <th>Prod. Score</th>
      </tr>
      ${snapshots.map(s => `
        <tr>
          <td>${s.user.email}</td>
          <td>${s.totalTasks}</td>
          <td>${s.completedTasks}</td>
          <td>${s.totalHours}</td>
          <td>${s.productivityScore}</td>
        </tr>
      `).join("")}
    </table>
  </div>

  <footer>
    Generated by Flowdash Workwise • Confidential
  </footer>

  <script>
    // 1️⃣ Task Distribution
    new Chart(document.getElementById('teamTasks'), {
      type: 'doughnut',
      data: {
        labels: ['Completed', 'Pending'],
        datasets: [{
          data: [${team.completedTasks}, ${team.totalTasks - team.completedTasks}],
          backgroundColor: ['#10b981', '#e5e7eb'],
          borderWidth: 0
        }]
      },
      options: {
        responsive: false,
        animation: false,
        cutout: '65%',
        plugins: {
          legend: { position: 'bottom' }
        }
      }
    });

    // 2️⃣ Productivity Leaderboard
    const employees = ${JSON.stringify(snapshots.map(s => s.user.email.split('@')[0]))};
    const scores = ${JSON.stringify(snapshots.map(s => s.productivityScore))};

    new Chart(document.getElementById('teamProductivity'), {
      type: 'bar',
      data: {
        labels: employees,
        datasets: [{
          data: scores,
          backgroundColor: '#3b82f6',
          borderRadius: 4
        }]
      },
      options: {
        responsive: false,
        animation: false,
        scales: {
          y: { beginAtZero: true, max: 100 },
          x: { grid: { display: false } }
        },
        plugins: {
          legend: { display: false }
        }
      }
    });

    // 3️⃣ Trend Chart
    const trendData = ${JSON.stringify(trends)};
    const labels = trendData.map(d => {
      const date = new Date(d.date);
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    });
    const counts = trendData.map(d => d.count);

    new Chart(document.getElementById('teamTrend'), {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          data: counts,
          borderColor: '#8b5cf6',
          backgroundColor: 'rgba(139,92,246,0.15)',
          fill: true,
          tension: 0.3,
          pointRadius: 3
        }]
      },
      options: {
        responsive: false,
        animation: false,
        scales: {
          y: { beginAtZero: true },
          x: { grid: { display: false } }
        },
        plugins: {
          legend: { display: false }
        }
      }
    });
  </script>

</body>
</html>
`;
}
//# sourceMappingURL=teamReportTemplate.js.map